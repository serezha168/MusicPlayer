# Документация по музыкальному плееру

## Основные компоненты

### MusicService

Сервис для управления музыкальными файлами.

Ключевые методы:

- `GetAllMusicFiles()`: Возвращает все загруженные музыкальные файлы.
- `LoadMusicFiles(string directoryPath)`: Загружает музыкальные файлы из указанной директории.
- `GetMusicFileByPath(string filePath)`: Возвращает музыкальный файл по указанному пути.

### AudioPlayerService

Сервис для воспроизведения аудио.

Ключевые методы:

- `LoadAudio(string filePath)`: Загружает аудиофайл для воспроизведения.
- `Play()`: Начинает воспроизведение.
- `Pause()`: Приостанавливает воспроизведение.
- `Stop()`: Останавливает воспроизведение.
- `SetVolume(float volume)`: Устанавливает громкость воспроизведения.
- `SetPosition(long position)`: Устанавливает позицию воспроизведения.
- `GetPosition()`: Возвращает текущую позицию воспроизведения.
- `GetLength()`: Возвращает общую длину аудиофайла.

### RelayCommand

Реализация команды для использования в MVVM паттерне.

Ключевые методы:

- `CanExecute(object? parameter)`: Проверяет, может ли команда быть выполнена.
- `Execute(object? parameter)`: Выполняет команду.
- `RaiseCanExecuteChanged()`: Уведомляет об изменении возможности выполнения команды.

### MainViewModel

Основной класс, отвечающий за логику приложения.

Ключевые свойства и методы:

- `IsPlaying`: Показывает, воспроизводится ли музыка в данный момент.
- `CurrentPosition`: Текущая позиция воспроизведения (от 0 до 1).
- `CurrentTime`: Текущее время воспроизведения в формате "мм:сс".
- `TotalTime`: Общая продолжительность трека в формате "мм:сс".
- `Volume`: Громкость воспроизведения (от 0 до 1).
- `IsUpdatingPosition`: Флаг, указывающий, обновляется ли позиция программно.
- `CurrentTrackArtist`: Имя исполнителя текущего трека.
- `CurrentTrackTitle`: Название текущего трека.
- `Play()`: Начинает воспроизведение.
- `Pause()`: Приостанавливает воспроизведение.
- `Stop()`: Останавливает воспроизведение.
- `OpenFile()`: Открывает диалог выбора аудиофайла.
- `SetPosition(double position)`: Устанавливает позицию воспроизведения.
- `UpdateTrackInfo(string filePath)`: Обновляет информацию о текущем треке.

## Новый функционал

### Отображение информации о текущем треке

Теперь приложение отображает имя исполнителя и название трека во время воспроизведения.

### Автоматическое обновление информации о треке

При загрузке нового трека информация о нем автоматически обновляется.

### Улучшенное управление позицией воспроизведения

Добавлен механизм для предотвращения конфликтов при обновлении позиции воспроизведения между пользовательским вводом и автоматическим обновлением.

## Использование

1. Запустите приложение.
2. Используйте кнопку "Open" для выбора музыкальных файлов.
3. Выберите трек из списка для воспроизведения.
4. Используйте кнопки "Play", "Pause" и "Stop" для управления воспроизведением.
5. Регулируйте громкость с помощью вертикального слайдера справа.
6. Используйте горизонтальный слайдер для изменения позиции воспроизведения.

## Зависимости

Приложение использует следующие библиотеки:
- NAudio для работы с аудио
- TagLib# для чтения метаданных аудиофайлов

## Примечания для разработчиков

- При работе с `RelayCommand` не забывайте вызывать `RaiseCanExecuteChanged()` при изменении условий выполнения команды.
- Обратите внимание на обработку исключений при работе с файлами в `MusicService` и при чтении метаданных в `UpdateTrackInfo`.
- Используйте свойство `IsUpdatingPosition` для предотвращения конфликтов при обновлении позиции воспроизведения.